var Dice=function(a){this.diceLi=document.createElement("li");this.diceLi.classList.add("dice");this.diceUl=a;this.number=Math.floor(6*Math.random())+1};Dice.prototype.add=function(){this.diceUl.appendChild(this.diceLi)};Dice.prototype.roll=function(){this.number=Math.floor(6*Math.random())+1;this.updateClass()};Dice.prototype.remove=function(){this.diceUl.lastElementChild.remove()};
Dice.prototype.updateClass=function(){this.diceLi.className="dice dice-side-"+"one two three four five six".split(" ")[this.number-1]};var Doc=function(){var a=document.body,b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("ul"),g=document.createElement("li"),e=document.createElement("div"),h=null,f=null;this.construct=function(){b.id="page-wrapper";c.id="page-menu-wrapper";g.id="icon-dice";e.id="page-content-wrapper";d.appendChild(g);c.appendChild(d);b.appendChild(c);b.appendChild(e);a.appendChild(b);h=document.getElementById("icon-dice");h.addEventListener("click",function(){f=new DiceApp(e);
f.construct();f.generateApp()})}};Doc.getInstance=function(){if(null==Doc._instance)Doc._instance=new Doc;else if(null!=Doc._instance)throw Error('Class "Doc" has already been instantiated.');return Doc._instance};document.addEventListener("DOMContentLoaded",function(){Doc.getInstance().construct()});var DiceApp=function(a){this.wrapper=a;this.diceUl=document.createElement("ul");this.wrapperContent=document.createElement("div");this.countUl=document.createElement("ul");this.countLi=document.createElement("li");this.rollLi=document.createElement("li");this.removeLi=document.createElement("li");this.addLi=document.createElement("li");this.btnUl=document.createElement("ul");this.wrapperToolbar=document.createElement("div");this.closeApp=document.createElement("div");this.wrapperMenu=document.createElement("div");
this.wrapperWidow=this.wrapperElem=document.createElement("div");this.audio=new Audio("src/wav/add.wav");this.counter=this.rowAmount=this.totDiceHeight=this.boxWidth=this.boxHeight=this.pos4=this.pos3=this.pos2=this.pos1=0;this.zeroLi=this.myTimeout=this.interval=null;this.diceList=[]};
DiceApp.prototype.construct=function(){this.wrapperContent.classList.add("dice-content-wrapper");this.countUl.classList.add("dice-toolbar-counter-wrapper");this.rollLi.classList.add("roll");this.removeLi.classList.add("remove");this.addLi.classList.add("add");this.wrapperToolbar.classList.add("dice-toolbar-wrapper");this.closeApp.classList.add("close");this.wrapperMenu.classList.add("dice-menubar-wrapper");this.wrapperElem.classList.add("dice-window-wrapper");this.wrapperElem.style.position="absolute";
this.wrapperElem.style.top="20px";this.wrapperElem.style.left="0px";this.wrapperElem.style.zIndex=0;this.wrapperContent.appendChild(this.diceUl);this.countLi.appendChild(this.countUl);this.btnUl.appendChild(this.addLi);this.btnUl.appendChild(this.removeLi);this.btnUl.appendChild(this.rollLi);this.btnUl.appendChild(this.countLi);this.wrapperToolbar.appendChild(this.btnUl);this.wrapperMenu.appendChild(this.closeApp);this.wrapperElem.appendChild(this.wrapperMenu);this.wrapperElem.appendChild(this.wrapperToolbar);
this.wrapperElem.appendChild(this.wrapperContent);this.rollLi.addEventListener("click",this.stopAction.bind(this));this.rollLi.addEventListener("mousedown",this.startAction.bind(this));this.removeLi.addEventListener("click",this.stopAction.bind(this));this.removeLi.addEventListener("mousedown",this.startAction.bind(this));this.addLi.addEventListener("click",this.stopAction.bind(this));this.addLi.addEventListener("mousedown",this.startAction.bind(this));this.closeApp.addEventListener("click",this.terminateApp.bind(this));
this.wrapperElem.addEventListener("mousedown",this.mouseDown.bind(this));this.wrapperElem.addEventListener("click",this.setIndex.bind(this));for(var a=0;5>a;a++)this.zeroLi=document.createElement("li"),this.zeroLi.classList.add("zero"),this.countUl.appendChild(this.zeroLi);this.myTimeout=setTimeout(function(){this.boxWidth=this.wrapperContent.clientWidth;this.boxHeight=this.wrapperContent.clientHeight}.bind(this),0)};DiceApp.prototype.generateApp=function(){this.wrapper.appendChild(this.wrapperWidow)};
DiceApp.prototype.terminateApp=function(){this.wrapperWidow.parentElement.removeChild(this.wrapperWidow);clearTimeout(this.myTimeout)};
DiceApp.prototype.addDice=function(){if(!(this.rowAmount*this.totDiceHeight>=this.boxHeight-this.totDiceHeight)){var a=new Dice(this.diceUl);a.add();a.updateClass();this.counter+=a.number;var b=this.counter.toString().split("").map(Number);this.countDice(b);this.diceList.push(a);this.computedStyle=window.getComputedStyle(a.diceLi);this.totDiceHeight=parseInt(this.computedStyle.height,10)+parseInt(this.computedStyle.marginBottom,10)+parseInt(this.computedStyle.marginTop,10);this.boxWidth-=this.totDiceHeight;
0>=this.boxWidth&&(this.rowAmount++,this.boxWidth=this.wrapperContent.clientWidth);this.audio.play()}};DiceApp.prototype.delDice=function(){var a=this.diceList[this.diceList.length-1];if(null!=a){var b=(this.counter-=a.number).toString().split("").map(Number);this.countDice(b);a.remove();this.diceList.pop();this.boxWidth+=this.totDiceHeight;this.boxWidth>this.wrapperContent.clientWidth&&(this.rowAmount--,this.boxWidth=28);this.audio.play()}};
DiceApp.prototype.reRoll=function(){if(null!=this.diceList[this.diceList.length-1]){this.boxWidth=this.wrapperContent.clientWidth;this.counter=this.rowAmount=0;this.diceList.forEach(function(b){b.roll();this.counter+=b.number;this.boxWidth-=this.totDiceHeight;0>=this.boxWidth&&(this.rowAmount++,this.boxWidth=this.wrapperContent.clientWidth)},this);var a=this.counter.toString().split("").map(Number);this.countDice(a);this.audio.play()}};
DiceApp.prototype.setIndex=function(){for(var a=document.getElementsByClassName("dice-window-wrapper"),b=0,c=0;c<a.length;c++){var d=parseInt(window.getComputedStyle(a[c]).zIndex,10);d>b&&(b=d)}this.wrapperElem.style.zIndex=b+1};
DiceApp.prototype.startAction=function(a){this.wrapperElem.removeEventListener("mousedown",this.mouseDown);a.target==this.removeLi?(this.delDice(),this.interval||(this.interval=setInterval(this.delDice.bind(this),500))):a.target==this.rollLi?(this.reRoll(),this.interval||(this.interval=setInterval(this.reRoll.bind(this),500))):(this.addDice(),this.interval||(this.interval=setInterval(this.addDice.bind(this),500)))};
DiceApp.prototype.stopAction=function(){clearInterval(this.interval);this.interval=null};DiceApp.prototype.countDice=function(a){for(var b=1;b<this.countUl.children.length+1;b++)this.countUl.children[5-b].className="zero one two three four five six seven eight nine".split(" ")[a[a.length-b]]};DiceApp.prototype.mouseDown=function(a){a=a||window.event;a.preventDefault();this.pos3=a.clientX;this.pos4=a.clientY;document.onmouseup=this.closeDragElement.bind(this);document.onmousemove=this.elementDrag.bind(this)};
DiceApp.prototype.elementDrag=function(a){a=a||window.event;a.preventDefault();this.pos1=this.pos3-a.clientX;this.pos2=this.pos4-a.clientY;this.pos3=a.clientX;this.pos4=a.clientY;this.wrapperElem.style.top=this.wrapperElem.offsetTop-this.pos2+"px";this.wrapperElem.style.left=this.wrapperElem.offsetLeft-this.pos1+"px";this.wrapperElem.style.opacity="0.5"};DiceApp.prototype.closeDragElement=function(){document.onmouseup=null;document.onmousemove=null;this.wrapperElem.style.opacity="1"};
